<?xml version="1.0" encoding="UTF-8"?>
<!-- JRXML compatible con JasperReports 6.20.0 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports 
                                  http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="FacturaReport" 
              language="java" 
              columnCount="1" 
              pageWidth="595" 
              pageHeight="842" 
              whenNoDataType="NoPages" 
              columnWidth="555" 
              leftMargin="20" 
              rightMargin="20" 
              topMargin="20" 
              bottomMargin="20">

    <!-- Parámetro -->
    <parameter name="ID_FACTURA" class="java.lang.Integer"/>

    <!-- Consulta SQL -->
    <queryString>
        <![CDATA[
        SELECT 
            f.id,
            f.numero,
            f.fecha_emision,
            f.fecha_servicio,
            f.concepto,
            f.base_imponible,
            f.iva_total,
            f.total_factura,
            f.estado,
            f.observaciones,
            f.tipo,
            emp.nombre AS empresa_nombre,
            emp.web AS empresa_web,
            ent.nombre AS cliente_nombre,
            p.descripcion AS producto_nombre,
            d.cantidad,
            d.precio_unitario,
            d.total_linea
        FROM factura f
        INNER JOIN empresa emp ON f.fk_id_empresa = emp.id
        LEFT JOIN cliente cli ON f.fk_id_cliente = cli.id
        LEFT JOIN entidad ent ON cli.id = ent.id
        INNER JOIN facturadetalle d ON f.id = d.fk_id_factura
        INNER JOIN producto p ON d.fk_id_producto = p.id
        WHERE f.id = $P{ID_FACTURA}
        ]]>
    </queryString>

    <!-- Campos -->
    <field name="id" class="java.lang.Long"/>
    <field name="numero" class="java.lang.String"/>
    <field name="fecha_emision" class="java.sql.Date"/>
    <field name="fecha_servicio" class="java.sql.Date"/>
    <field name="concepto" class="java.lang.String"/>
    <field name="base_imponible" class="java.math.BigDecimal"/>
    <field name="iva_total" class="java.math.BigDecimal"/>
    <field name="total_factura" class="java.math.BigDecimal"/>
    <field name="estado" class="java.lang.String"/>
    <field name="observaciones" class="java.lang.String"/>
    <field name="tipo" class="java.lang.String"/>
    <field name="empresa_nombre" class="java.lang.String"/>
    <field name="empresa_web" class="java.lang.String"/>
    <field name="cliente_nombre" class="java.lang.String"/>
    <field name="producto_nombre" class="java.lang.String"/>
    <field name="cantidad" class="java.math.BigDecimal"/>
    <field name="precio_unitario" class="java.math.BigDecimal"/>
    <field name="total_linea" class="java.math.BigDecimal"/>

    <!-- Título -->
    <title>
        <band height="90">
            <textField>
                <reportElement x="0" y="0" width="350" height="30"/>
                <textFieldExpression><![CDATA[$F{empresa_nombre}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="30" width="350" height="20"/>
                <textFieldExpression><![CDATA[$F{empresa_web}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="60" width="300" height="30"/>
                <text><![CDATA[Factura]]></text>
            </staticText>
        </band>
    </title>

    <!-- Encabezado de página -->
    <pageHeader>
        <band height="80">
            <textField>
                <reportElement x="0" y="0" width="350" height="20"/>
                <textFieldExpression><![CDATA["Cliente: " + $F{cliente_nombre}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="20" width="350" height="20"/>
                <textFieldExpression><![CDATA["Factura Nº: " + $F{numero}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="40" width="350" height="20"/>
                <textFieldExpression><![CDATA["Fecha emisión: " + $F{fecha_emision}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="0" y="60" width="350" height="20"/>
                <textFieldExpression><![CDATA["Fecha servicio: " + $F{fecha_servicio}]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>

    <!-- Column Header -->
    <columnHeader>
        <band height="20">
            <staticText>
                <reportElement x="0" y="0" width="200" height="20"/>
                <text><![CDATA[Producto]]></text>
            </staticText>
            <staticText>
                <reportElement x="200" y="0" width="80" height="20"/>
                <text><![CDATA[Cantidad]]></text>
            </staticText>
            <staticText>
                <reportElement x="280" y="0" width="100" height="20"/>
                <text><![CDATA[Precio]]></text>
            </staticText>
            <staticText>
                <reportElement x="380" y="0" width="100" height="20"/>
                <text><![CDATA[Total]]></text>
            </staticText>
        </band>
    </columnHeader>

    <!-- Detalle -->
    <detail>
        <band height="20">
            <textField>
                <reportElement x="0" y="0" width="200" height="20"/>
                <textFieldExpression><![CDATA[$F{producto_nombre}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="200" y="0" width="80" height="20"/>
                <textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="280" y="0" width="100" height="20"/>
                <textFieldExpression><![CDATA[$F{precio_unitario}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="380" y="0" width="100" height="20"/>
                <textFieldExpression><![CDATA[$F{total_linea}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <!-- Resumen -->
    <summary>
        <band height="70">
            <textField>
                <reportElement x="300" y="10" width="200" height="20"/>
                <textFieldExpression><![CDATA["Base imponible: " + $F{base_imponible}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="300" y="30" width="200" height="20"/>
                <textFieldExpression><![CDATA["IVA: " + $F{iva_total}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="300" y="50" width="200" height="20"/>
                <textFieldExpression><![CDATA["TOTAL: " + $F{total_factura}]]></textFieldExpression>
            </textField>
        </band>
    </summary>

</jasperReport>
